<?php
/**
 * Copyright Â© 2016 Magento. All rights reserved.
 * See COPYING.txt for license details.
 */

// @codingStandardsIgnoreFile

?>
<script type="text/x-magento-template" id="fastly-uploadvcl-template">
    <div class="messages">
        <div class="message message-warning fastly-message-warning" style="display: none">
            <?php /* @escapeNotVerified */ echo __("You are about to clone your active version #x.")?>
            <?php /* @escapeNotVerified */ echo __("We'll upload your VCL to version #y.")?>
        </div>
        <div class="message message-error fastly-message-error" style="display: none">
        </div>
    </div>
    <form action="<?php echo $block->getUrl('adminhtml/fastlyCdn_Vcl/upload'); ?>" method="POST" id="vcl-upload-form" class="form-inline" enctype="multipart/form-data">
        <fieldset class="admin__fieldset form-list question">
            <div class="admin__field field maintenance-checkbox-container">
                <label for="fastly_activate_vcl" class="admin__field-label"><span><?php /* @escapeNotVerified */ echo __('Activate VCL after upload')?></span></label>
                <div class="admin__field-control">
                    <div class="admin__field-option">
                        <input class="admin__control-checkbox" type="checkbox" name="fastly_activate_vcl" id="fastly_activate_vcl" checked/>
                        <label class="admin__field-label" for="fastly_activate_vcl"></label>
                    </div>
                </div>
            </div>
        </fieldset>
    </form>
</script>

<script type="text/x-magento-template" id="fastly-tls-template">
    <div class="messages">
        <div class="message message-warning fastly-message-warning" style="display: none">
            <?php /* @escapeNotVerified */ echo __("You are about to clone your active version #x.")?>
            <?php /* @escapeNotVerified */ echo __("We'll make the changes to version #y.")?>
        </div>
        <div class="message message-error fastly-message-error" style="display: none">
        </div>
    </div>
    <form action="<?php echo $block->getUrl('adminhtml/fastlyCdn_Vcl/upload'); ?>" method="POST" id="vcl-upload-form" class="form-inline" enctype="multipart/form-data">
        <fieldset class="admin__fieldset form-list question">
            <div class="admin__field field maintenance-checkbox-container">
                <label for="fastly_activate_vcl" class="admin__field-label"><span><?php /* @escapeNotVerified */ echo __('Activate after the change')?></span></label>
                <div class="admin__field-control">
                    <div class="admin__field-option">
                        <input class="admin__control-checkbox" type="checkbox" name="fastly_activate_tls" id="fastly_activate_tls" checked/>
                        <label class="admin__field-label" for="fastly_activate_tls"></label>
                    </div>
                </div>
            </div>
        </fieldset>
    </form>
</script>

<script type="text/x-magento-template" id="fastly-backend-template">
    <div class="messages">
        <div class="message message-warning fastly-message-warning" style="display: none">
            <?php /* @escapeNotVerified */ echo __("You are about to clone your active version #x.")?>
            <?php /* @escapeNotVerified */ echo __("Your backend will be reconfigured in version #y.")?>
        </div>
        <div class="message message-error fastly-message-error" style="display: none">
        </div>
    </div>
    <form action="<?php echo $block->getUrl('adminhtml/fastlyCdn_Vcl/upload'); ?>" method="POST" id="backend-upload-form" class="form-inline" enctype="multipart/form-data">
        <fieldset class="admin__fieldset form-list question">
            <input hidden="hidden" name="backend_name" id="backend_name" class="admin__control-text">
            <div class="admin__field field">
                <label for="shield" class="admin__field-label"><span><?php echo __("Shield") ?></span></label>
                <div class="admin__field-control">
                    <select name="shield" id="backend_shield" class="admin__control-text">
                        <option value="">(none)</option>
                        <option value="fjr-ae">AE, Fujairah Al Mahta - Dubai</option>
                        <option value="brisbane-au">AU, Brisbane</option>
                        <option value="melbourne-au">AU, Melbourne</option>
                        <option value="perth-au">AU, Perth</option>
                        <option value="sydney-au">AU, Sydney</option>
                        <option value="gru-br-sa">BR, Sao Paulo</option>
                        <option value="yyz-on-ca">CA, Toronto</option>
                        <option value="yul-montreal-ca">CA, Montreal</option>
                        <option value="mad-madrid-es">ES, Madrid</option>
                        <option value="cdg-par-fr">FR, Paris</option>
                        <option value="hongkong-hk">HK, Hong Kong</option>
                        <option value="hhn-frankfurt-de">DE, Frankfurt - Interxion</option>
                        <option value="frankfurt-de">DE, Frankfurt - Recommended for AWS eu-central1 origins</option>
                        <option value="tokyo-jp2">JP, Tokyo</option>
                        <option value="osaka-jp">JP, Osaka</option>
                        <option value="amsterdam-nl">NL, Amsterdam - Recommended for GCP eu-west1 origins</option>
                        <option value="auckland-akl">NZ, Auckland</option>
                        <option value="stockholm-bma">SE, Stockholm</option>
                        <option value="singapore-sg">SG, Singapore</option>
                        <option value="london_city-uk">UK, London - LCY</option>
                        <option value="london-uk">UK, London - LHR - Recommended for AWS eu-west1/2 origins</option>
                        <option value="atl-ga-us">US, Atlanta, GA</option>
                        <option value="bos-ma-us">US, Boston, MA</option>
                        <option value="ord-il-us">US, Chicago, IL - Recommended for GCP us-central1</option>
                        <option value="den-co-us">US, Denver, CO</option>
                        <option value="dallas-tx-us">US, Dallas, TX</option>
                        <option value="iad-va-us">US, Washington, DC - Recommended for AWS us-east1/GCP us-east1 origins</option>
                        <option value="lax-ca-us">US, Los Angeles, CA</option>
                        <option value="miami-fl-us">US, Miami, FL</option>
                        <option value="jfk-ny-us">US, New York City, NY</option>
                        <option value="sjc-ca-us">US, San Jose, CA</option>
                        <option value="sea-wa-us">US, Seattle, WA - Recommended for AWS us-west2 origins</option>
                        <option value="jnb-johannesburg-za">ZA, Johannesburg</option>
                    </select>
                    <div class="admin__field-note">
                        The shield POP designated to reduce inbound load on this origin by serving the cached data to the rest of the network.
                        <a href="https://docs.fastly.com/guides/performance-tuning/shielding" target="_blank">Click for more details.</a></div>
                </div>
            </div>

            <div class="admin__field field _required">
                <label for="connect_timeout" class="admin__field-label"><span><?php echo __("Connect timeout") ?></span></label>
                <div class="admin__field-control">
                    <input name="connect_timeout" type="number" required="required" id="backend_connect_timeout" class="admin__control-text required-entry validate-alphanum-with-spaces validate-length maximum-length-50">
                    <div class="admin__field-note">How long to wait for a timeout in milliseconds.</div>
                </div>
            </div>

            <div class="admin__field field _required">
                <label for="between_bytes_timeout" class="admin__field-label"><span><?php echo __("Between bytes timeout") ?></span></label>
                <div class="admin__field-control">
                    <input name="between_bytes_timeout" type="number" required="required" id="backend_between_bytes_timeout" class="admin__control-text">
                    <div class="admin__field-note">How long to wait between bytes in milliseconds.</div>
                </div>
            </div>

            <div class="admin__field field _required">
                <label for="first_byte_timeout " class="admin__field-label"><span><?php echo __("First byte timeout ") ?></span></label>
                <div class="admin__field-control">
                    <input name="first_byte_timeout" type="number" required="required" id="backend_first_byte_timeout" class="admin__control-text">
                    <div class="admin__field-note">How long to wait for the first bytes in milliseconds.</div>
                </div>
            </div>

            <div class="admin__field field maintenance-checkbox-container">
                <label for="fastly_activate_backend" class="admin__field-label"><span><?php /* @escapeNotVerified */ echo __('Activate after the change')?></span></label>
                <div class="admin__field-control">
                    <div class="admin__field-option">
                        <input class="admin__control-checkbox" type="checkbox" name="fastly_activate_backend" id="fastly_activate_backend" checked/>
                        <label class="admin__field-label" for="fastly_activate_backend"></label>
                    </div>
                </div>
            </div>
        </fieldset>
    </form>
</script>

<script type="text/x-magento-template" id="fastly-error-page-template">
    <div class="messages">
        <div class="message message-warning fastly-message-warning" style="display: none">
            <?php /* @escapeNotVerified */ echo __("You are about to clone your active version #x.")?>
            <?php /* @escapeNotVerified */ echo __("We'll make the changes to version #y.")?>
        </div>
        <div class="message message-error fastly-message-error" style="display: none">
        </div>
    </div>
    <form action="<?php echo $block->getUrl('adminhtml/fastlyCdn_Vcl/upload'); ?>" method="POST" id="vcl-error-page-form" class="form-inline" enctype="multipart/form-data">
        <fieldset class="admin__fieldset form-list question">
            <div class="admin__field field maintenance-checkbox-container">
                <label for="fastly_activate_vcl" class="admin__field-label"><span><?php /* @escapeNotVerified */ echo __('Activate after the change')?></span></label>
                <div class="admin__field-control">
                    <div class="admin__field-option">
                        <input class="admin__control-checkbox" type="checkbox" name="fastly_activate_vcl" id="fastly_activate_vcl" checked/>
                        <label class="admin__field-label" for="fastly_activate_tls"></label>
                    </div>
                </div>
            </div>
            <div class="admin__field field _required">
                <label for="error_page_html" class="admin__field-label"><span><?php echo __("HTML") ?></span></label>
                <div class="admin__field-control">
                    <textarea rows="10" name="error_page_html" required="required" id="error_page_html" class="admin__control-text"></textarea>
                </div>
            </div>
        </fieldset>
    </form>
</script>

<script type="text/x-magento-template" id="fastly-dictionary-container-template">
    <div class="messages">
        <div class="message message-warning fastly-message-warning" style="display: none">
            <?php /* @escapeNotVerified */ echo __("You are about to clone your active version #x.")?>
            <?php /* @escapeNotVerified */ echo __("We'll make the changes to version #y.")?>
        </div>
        <div class="message message-error fastly-message-error" style="display: none">
        </div>
    </div>
    <form action="<?php echo $block->getUrl('adminhtml/fastlyCdn_Vcl/upload'); ?>" method="POST" id="dictionary-container-form" class="form-inline" style="margin-top:25px;" enctype="multipart/form-data">
        <fieldset class="admin__fieldset form-list question">
            <div class="admin__field field _required">
                <label for="dictionary_name" class="admin__field-label"><span><?php echo __("Dictionary name") ?></span></label>
                <div class="admin__field-control">
                    <input name="dictionary_name" type="text" required="required" id="dictionary_name" class="admin__control-text">
                </div>
            </div>
            <div class="admin__field field maintenance-checkbox-container">
                <label for="fastly_activate_vcl" class="admin__field-label"><span><?php /* @escapeNotVerified */ echo __('Activate after the change')?></span></label>
                <div class="admin__field-control">
                    <div class="admin__field-option">
                        <input class="admin__control-checkbox" type="checkbox" name="fastly_activate_vcl" id="fastly_activate_vcl" checked/>
                        <label class="admin__field-label" for="fastly_activate_tls"></label>
                    </div>
                </div>
            </div>
        </fieldset>
    </form>
</script>

<script type="text/x-magento-template" id="fastly-edge-items-template">
    <div class="messages">
        <div class="message message-error fastly-message-error" style="display: none; margin-bottom: 15px;"></div>
        <div class="message message-success fastly-message-success" style="display: none;"></div>
    </div>
    <form action="<?php echo $block->getUrl('adminhtml/fastlyCdn_Vcl/upload'); ?>" method="POST" id="fastly-dictionary-form" class="form-inline" enctype="multipart/form-data">

        <fieldset class="admin__fieldset form-list question">
            <table class="admin__control-table" id="dictionary-items-table">
                <thead>
                <tr>
                    <th><?php echo __('Key') ?></th>
                    <th><?php echo __('Value') ?></th>
                    <th class="col-actions" colspan="1"><?php echo __('Action') ?></th>
                </tr>
                </thead>
                <tbody class="item-container">
                <tr>
                    <td><input name="key" required="required" class="input-text admin__control-text dictionary-items-field" type="text"></td>
                    <td><input name="value" required="required" class="input-text admin__control-text dictionary-items-field" type="text"></td>
                    <td class="col-actions">
                        <button class="action-delete fastly-save-action save_item" title="Save" type="button"><span>Save</span></button>
                        <button class="action-delete remove_item"  title="Delete" type="button"><span>Delete</span></button>
                    </td>
                </tr>
                </tbody>
                <tfoot>
                <tr>
                    <td colspan="3" class="col-actions-add">
                        <button id="add-dictionary-item" class="action-add" title="Add new item" type="button">
                            <span><?php echo __('Add new item') ?></span>
                        </button>
                    </td>
                </tr>
                </tfoot>
            </table>
        </fieldset>
    </form>
</script>

<?php

/**
 * AJAX urls passed to uploadvcl.js file
 */

$serviceInfoUrl = $block->getUrl('adminhtml/fastlyCdn_Vcl/serviceInfo');
$vclUploadUrl = $block->getUrl('adminhtml/fastlyCdn_Vcl/upload');
$testServiceUrl = $block->getUrl('adminhtml/fastlyCdn/testConnection');
$checkTlsSettingUrl = $block->getUrl('adminhtml/fastlyCdn_Vcl/checkTlsSetting');
$toggleTlsSettingUrl = $block->getUrl('adminhtml/fastlyCdn_Vcl/forceTls');
$fetchBackendsUrl = $block->getUrl('adminhtml/fastlyCdn_Vcl/getBackends');
$configureBackendUrl = $block->getUrl('adminhtml/fastlyCdn_Vcl/configureBackend');
$isAlreadyConfiguredUrl = $block->getUrl('adminhtml/fastlyCdn_Vcl/isAlreadyConfigured');
$savePageErrorHtml = $block->getUrl('adminhtml/fastlyCdn_Vcl/SaveErrorPageHtml');
$getErrorPageRespObjUrl = $block->getUrl('adminhtml/fastlyCdn_Vcl/GetErrorPageRespObj');
$createDictionary = $block->getUrl('adminhtml/fastlyCdn_Edge_Dictionary/Create');
$listDictionaries = $block->getUrl('adminhtml/fastlyCdn_Edge_Dictionary/ListAll');
$dictionaryItems = $block->getUrl('adminhtml/fastlyCdn_Edge_Dictionary_Item/ListAll');
$createDictionaryItem = $block->getUrl('adminhtml/fastlyCdn_Edge_Dictionary_Item/Create');
$deleteDictionaryItem = $block->getUrl('adminhtml/fastlyCdn_Edge_Dictionary_Item/Delete');

/* This flag is used to prevent calling ajax requests if fastly extension is not selected as caching application  */
$isFastlyEnabled = $block->getConfig()->isFastlyEnabled();
?>


<script type="text/x-magento-init">
        {
            "*": {
                "Fastly_Cdn/js/uploadvcl": {
                    "serviceInfoUrl": "<?php echo $block->escapeJsQuote($serviceInfoUrl);?>",
                    "vclUploadUrl": "<?php echo $block->escapeJsQuote($vclUploadUrl);?>",
                    "testServiceUrl": "<?php echo $block->escapeJsQuote($testServiceUrl);?>",
                    "checkTlsSettingUrl": "<?php echo $block->escapeJsQuote($checkTlsSettingUrl);?>",
                    "toggleTlsSettingUrl": "<?php echo $block->escapeJsQuote($toggleTlsSettingUrl);?>",
                    "isFastlyEnabled": "<?php echo $block->escapeJsQuote($isFastlyEnabled);?>",
                    "fetchBackendsUrl": "<?php echo $block->escapeJsQuote($fetchBackendsUrl);?>",
                    "configureBackendUrl": "<?php echo $block->escapeJsQuote($configureBackendUrl);?>",
                    "isAlreadyConfiguredUrl": "<?php echo $block->escapeJsQuote($isAlreadyConfiguredUrl);?>",
                    "saveErrorPageHtmlUrl": "<?php echo $block->escapeJsQuote($savePageErrorHtml);?>",
                    "getErrorPageRespObj": "<?php echo $block->escapeJsQuote($getErrorPageRespObjUrl);?>",
                    "createDictionary": "<?php echo $block->escapeJsQuote($createDictionary);?>",
                    "getDictionaries": "<?php echo $block->escapeJsQuote($listDictionaries);?>",
                    "getDictionaryItems": "<?php echo $block->escapeJsQuote($dictionaryItems);?>",
                    "createDictionaryItem": "<?php echo $block->escapeJsQuote($createDictionaryItem);?>",
                    "deleteDictionaryItem": "<?php echo $block->escapeJsQuote($deleteDictionaryItem);?>"
                }
            }
        }
</script>

<style type="text/css">
    #backend-upload-form {
        margin-top: 25px;
    }

    .dictionary-items-field {
        width: 100%;
    }

    .admin__control-table .fastly-save-action::before {
        content: '\e636';
        font-size: 2rem;
    }

</style>


